= 无线网络和移动网络

== 笔记

image::fig7-1.png[width=350]

[plantuml, target=ch7-1a, format=svg]
....
@startmindmap
* 无线网络的要素
**:无线主机
* 是运行应用
程序的端系统
设备;
**:无线通信链路
* 主机通过其
连接到一个基
站或者另一台
无线主机;
*** 覆盖区域
*** 链路速率
*** 比特差错率
**:基站
* 负责向与之
关联的无线主
机发送数据和
从主机那里接
收数据
* 链路层中继;
***:关联
* 主机位于该
基站的无线通
信覆盖范围
内，且使用该
基站中继它和
更大网络之间
的数据;
***:切换
* 主机改变与
之相关联的基
站;
**:网络基础设施
* 无线主机希
望与之进行通
信的更大网络;
@endmindmap
....

[plantuml, target=ch7-1b, format=svg]
....
@startmindmap
*:无线网络的分类
# 在该无线网
络中的分组是
否跨越了一个
无线跳或多个
无线跳
# 网络中是否
有诸如基站这
样的基础设施;
** 单跳，基于基础设施
***:* 802.11
* 4G;
** 单跳，无基础设施
***:*蓝牙
* 自组织模式的802.11;
** 多跳，基于基础设施
***:* 无线传感网络
* 无线网状网络(mesh);
** 多跳，无基础设施
@endmindmap
....

.基础设施模式和自组织模式的比较
[cols="3*"]
|===
||基础设施模式|自组织模式

h|网络服务（地址分配、路由选择、DNS等）由谁提供
|由网络经基站向主机提供
|主机本身提供
|===

.802.11网络和以太网的类比
|===
|网络 |主机接口 |链路层交换机

|802.11网络 |无线网络接口 |接入点
|以太网 |以太网接口 |以太网交换机
|===

[plantuml, target=ch7-1c, format=svg]
....
@startmindmap
* 物理层的特征
**:对于给定的调
至方案， SNR
越高， BER越
低;
***:增加传输功率
可以降低接收
到差错帧的概
率;
***:增加传输功率的缺点:
# 消耗更多能量
# 可能干扰另一个发送方;
**:对于给定的
SNR，调制技
术的比特传输
率越高，BER
越高;
**:物理层调制技
术的动态选择
能用于适配对
信道条件的调
制技术;
@endmindmap
....

[plantuml, target=ch7-1d, format=svg]
....
@startmindmap
*:无线链路与有
线链路间的差异;
left side
** 递减的信号强度
*** 穿过物体
*** 路径损耗
** 来自其他源的干扰
***:在同一个频段
发送信号的电
波源;
*** 环境中的电磁噪声
** 多径传播
right side
** 较高的、时变的比特差错率
** 接收方无法检测碰撞
*** 隐藏终端问题
*** 信号强度的衰减
@endmindmap
....

[plantuml, target=ch7-1e, format=svg]
....
@startmindmap
* 802.11标准的共同特征
** 相同的媒体访问协议CSMA/CA
** 相同的链路层帧结构
**:具有减少传输
速率的能力以
伸展到更远的
距离;
** 向后兼容
@endmindmap
....

[.float-group]
--
[.left]
image::fig7-7.png[width=300]

基本服务集Basic Service Set, BSS +
接入点Access Point, AP
--

image::fig7-9.png[width=540]

.CSMA/CD与CSMA/CA的比较
[cols="1h,2,2"]
|===
h| |CSMA/CD |CSMA/CA

|碰撞
a|碰撞检测

* 在CSMA/CD协议中碰撞并非是一个严重的问题，因为两个站点检测到碰撞后都会放弃它们的发送，从而避免了由于碰撞而造成的该帧剩余部分的无用发送

a|碰撞避免

* 检测碰撞的能力要求站点具有同时发送和接收的能力。因为在802.11适配器上，接收信号的强度通常远远小于发送信号的强度，制造具有检测碰撞能力的硬件代价较大
* 即使适配器可以同时发送和监听信号，适配器也会由于隐藏终端问题和衰减问题而无法检测到所有的碰撞

|重传
|链路层确认/重传
|不使用
|===

.CSMA/CA运行状态图
[plantuml, target=ch7-1f, format=svg]
....
@startuml
hide empty description
state "就绪" as Ready
state "监听信道" as Listening
state "回退等待" as Backoff
state "发送中" as Sending
state "等待确认" as WaitingACK
[*] --> Ready
Ready --> Listening : 获得数据报\n----\n准备链路层帧\n放入适配器缓存
Listening --> Sending : 信道空闲\n----\n等待分布式帧间间隔
Listening --> Backoff : 信道忙\n----\n选取随机回退值
Backoff --> Backoff : 信道空闲\n----\n递减回退值
Backoff --> Backoff : 信道忙\n----\n抑制
Backoff --> Sending : 回退值减为0
Sending --> WaitingACK : 完全发送帧
WaitingACK --> Ready : 收到确认
WaitingACK --> Backoff : 未收到确认\n----\n从更大范围选取回退值
@enduml
....

[.float-group]
--
[.left]
image::ch6-3b.svg[]

与左边的CSMA/CD状态图相比，CSMA/CA增加了两个部分：1.从监听信道到回退等待；2.从发送中到等待确认到回退等待。在CSMA/CA中，监听信道忙不会进入回退等待，而是一旦空闲就发送；从发送中一旦检测到碰撞就进入回退等待，而不需要等待确认。
--

=== GSM 2G蜂窝网

image::fig7-18.png[width=550]
cellular:: 蜂窝，由一个蜂窝网覆盖的区域被分成许多称作小区的地理覆盖区域。
BTS:: Base Transceiver Station，收发基站，负责向位于其小区内的移动站点发送或接收信号。
BSC:: Base Station Controller，基站控制器，为移动用户分配BTS无线信道，执行寻呼，执行移动用户的切换。
BSS:: Base Station System，基站系统，基站控制器及其控制的收发基站共同构成了GSM基站系统。
MSC:: Mobile Switching Center，移动交换中心，在用户鉴别和账户管理以及呼叫建立和切换中起着决定性的作用。

=== 3G蜂窝数据网

image::fig7-19.png[width=610]

RNC:: Radio Network Controller，无线电网络控制器，通常控制几个小区的收发基站，既通过MSC与电路交换蜂窝语音网连接，又通过SGSN与分组交换的因特网连接。
GPRS:: General Packet Radio Service，通用分组无线服务，是一种在2G网络中的早期蜂窝数据服务。
SGSN:: Serving GPRS Support Node，服务GPRS支持节点，负责向移动节点交付或获取数据报。SGSN与该区域蜂窝语音网的MSC进行交互，提供用户认证和切换，维护活跃移动节点的位置信息。
GGSN:: Gateway GPRS Support Node，网关GPRS支持节点，起着网关的作用，将多个SGSN连接到更大的因特网。

[#4g-lte]
=== 4G LTE

image::fig7-20.png[width=560]

eNodeB:: 2G基站和3G无线电网络控制器的逻辑后代。在数据平面中，UE数据报在eNodeB被封装，并且通过4G网络的全IP强化分组核以隧道形式传输到P-GW。在控制平面中，eNodeB代表UE来处理注册和移动性信令流量。
MME:: Mobility Management Entity，移动性管理实体，代表位于它所控制单元中的UE，执行连接和移动性管理。它从HHS接收UE订购信息。
HSS:: Home Subscriber Server，归属用户服务，包含了包括漫游接入能力、服务质量配置文件和鉴别信息的UE信息。该HSS从UE归属蜂 窝提供商得到这些信息。
S-GW:: Serving Gateway，服务网关，是数据平面移动性锚点，即所有UE流量将通过S-GW传递。该S-GW也执行收费/记账功能以及法定的流量拦截。
P-GW:: Packet Data Network Gateway，分组数据网络网关，给UE分配IP地址，并且保证QoS实施。作为隧道端点，当向或从UE转发数据报时，它也执行数据报封装/解封装。

[#comparison-of-234g-cellular-network-architectures]
=== 2、3、4代蜂窝网体系结构的比较

[cols="1,2,2,2"]
|===
||2G |3G |4G

h|无线电接口
|组合的FDM/TDM
|WCDMA, HSPA
|OFDM

h|无线电接入网
|无线设备-收发基站BTS-基站控制器BSC
|无线设备-BTS-无线电网络控制器RNC
|无线设备-BTS-eNodeB

h|链路
|BSC-移动交换中心MSC-网关MSC-公共电话网
a|* RNC-MSC-网关MSC-公共电话网
* RNC-服务GPRS支持节点SGSN-网关GPRS支持节点GGSN-公共因特网
|eNodeB-全IP强化分组核EPC-分组数据网络网关PGW-网络的其他部分
|===

=== 移动管理原理

image::fig7-22.png[width=550]

image::fig7-23.png[width=510]

归属网络:: home network，一个移动节点的永久居所。
归属代理:: home agent，在归属网络中代表移动节点执行移动管理功能的实体。
被访网络:: visited network，移动节点当前所在网络。
外部代理:: foreign agent，在被访网络中帮助移动节点做移动管理功能的实体。
通信者:: correspondent，希望与该移动节点通信的实体。
COA:: Care-Of Address，转交地址，该COA的网络部分与外部网络的网络部分相匹配。

[plantuml, target=ch7-5a, format=svg]
....
@startmindmap
*:移动性对网络应用
透明;
**:含义
----
# 移动时网络地址
不变
# 位于外部网络时
指向此节点固定地
址的流量导向外部
网络;
**:方法一，核心网络
----
通过交换域内和域
间路由信息向所有
其他网络发通告，
告诉它们该移动节
点正在它的网络中
--缺点--
# 扩展性差，路由
器需要维护可能多
达数百万个移动节
点的转发表
# TODO;
** 方法二，边缘网络
***:移动节点的间接路
由选择
--缺点--
三角路由选择问题;
***:移动节点的直接路
由选择
--挑战--
# 通信者代理向归
属代理查询获得移
动节点的COA
# 将数据路由选择
到移动节点新的外
部网络;
@endmindmap
....

=== 移动节点的间接路由选择

image::fig7-24.png[width=510]

. 通信者将数据报寻址到移动节点的固定地址，并将数据报发送到网络中去。
. 归属代理截获这些数据报，将原始完整数据报封装在一个新的较大的数据报中，通过使用移动节点的COA，该数据报先转发给外部代理。
. 外部代理将接收并拆封该数据报，即从较大的封装数据报中取出通信者的原始数据报，然后再向移动节点转发该原始数据报。
. 移动节点直接将其数据报寻址到通信者（使用自己的永久地址作为源地址，通信者的地址作为目的地址）。

[plantuml, target=ch7-4b, format=svg]
....
@startuml
participant "通信者" as CD
participant "归属代理" as HA
participant "外部代理" as FA
participant "移动节点" as MN
MN -> FA : 注册
FA -> HA : 注册
CD -> HA : 寻址移动节点\n的固定地址
rnote over HA : 截获\n封装
HA -> FA : 寻址COA
rnote over FA : 拆封
FA -> MN : 转发COA
MN -> FA : 取消注册
@enduml
....

=== 移动节点的直接路由选择

image::fig7-26.png[width=520]

. 通信者代理向归属代理查询移动节点的COA
. 归属代理告知移动节点的COA
. 通信者代理使用隧道技术将数据报发往外部代理
. 外部代理拆封该数据报，将原始数据报转发到移动节点

image::fig7-27.png[width=580]

锚外部代理:: anchor foreign agent，首次发现移动节点的外部网络中的外部代理

[start=2]
. 移动节点到达一个新外部网络
. 移动节点向新的外部代理注册
. 新外部代理向锚外部代理提供移动节点的新COA
. 当锚外部代理收到一个发往已经离开的移动节点的封装数据报后，它可以使用新的COA重新封装数据报并将其转发给该移动节点

=== 移动IP

image::fig7-29.png[width=570]

=== 蜂窝网中的移动性

HLR:: Home Location Register，归属位置注册器，由归属网络维护的一个包括它每个用户的永久蜂窝电话号码、用户个人概要信息以及这些用户当前的位置信息的数据库。
VLR:: Visitor Location Register，访问者位置注册，VLR为每一个当前在其服务网络中的移动用户包含一个表项。

image::fig7-30.png[width=450]

. 呼叫从通信者通过公共交换电话网到达移动用户归属网络中的归属 MSC。
. 归属MSC收到该呼叫并查询HLR来确定移动用户的位置。
.. 在最简单的情况下，HLR返回移动站点漫游号码。
.. 如果HLR不具有该漫游号码，它返回被访网络中VLR的地址。在这种情况下，归属MSC需要查询VLR以便获取移动节点的漫游号码。
. 给定一个漫游号码，归属MSC通过网络到达被访网络的MSC建立呼叫。

=== GSM中的切换

image::fig7-32.png[width=330]

. 旧BS通知MSC和用户将切换到新BS
. MSC分配资源并告知新BS
. 新BS分配资源
. 新BS通过MSC-旧BS向移动用户提供与新的BS相关联所需要的信息
. 移动用户被旧BS告知它应当进行一个切换
. 移动用户激活新BS中新的信道
. 移动用户向新BS-MSC发送一个切换完成报文。MSC重路由选择呼叫，使其经过新BS
. 旧BS释放资源

image::fig7-33.png[width=520]

当移动用户从一个MSC覆盖区到达另一个MSC覆盖区后，正在进行的呼叫被重路由选择，从锚MSC到包含新基站的新被访问MSC。

image::tb7-2.png[width=680]

=== 解决TCP拥塞控制在无线情况下的问题

. 本地恢复，在比特差错出现的当时和当地将其恢复。
. TCP发送方知晓无线链路，从而将在有线网络中发生的拥塞性丢包和在无线网络中发生的差错/丢包区分开，并且仅对有线网络中的拥塞性丢包采用拥塞控制。
. 分离连接方法，经有线段的运输层是标准的TCP协议，经无线段的运输层是一个特别定制运行在UDP上的差错恢复协议。

== 复习题

=== R1 基础设施模式和自组织模式

一个无线网络运行在“基础设施模式”下是什么含义？如果某网络没有运行在基础设施模式下，那么它运行在什么模式下？这种运行模式与基础设施模式之间有什么不同？

一个无线网络运行在“基础设施模式”下意味着所有传统的网络服务都由网络向通过基站相连的主机提供。如果网络没有运行在基础设施模式下，那么它运行在自组织模式下。这种运行模式下的网络中的主机本身提供诸如路由选择、地址分配、DNS等服务。

=== R2

在7.1节的分类法中，所确定的四种无线网络类型各是什么？你已经使用的是这些无线网络类型中的哪一种？

四种无线网络类型分别是单跳基于基础设施、单跳无基础设施、多跳基于基础设施和多跳无基础设施，我使用的是单跳基于基础设施。

=== R3

下列类型的无线信道损伤之间有什么区别：路径损耗、多径传播、来自其他源的干扰？

路径损耗：电磁波强度随着传播距离的增加而减弱。

多径传播：电磁波的一部分受物体和地面反射，在发送方和接收方之间走了不同长度的路径，使得接收方收到的信号变得模糊。

来自其他源的干扰：在同一个频段发送信号的电波源相互干扰。

=== R4 无线信道的物理特征

随着移动节点离开基站越来越远，为了保证传送帧的丢失概率不增加，基站能够采取的两种措施是什么？

移动节点离开基站越来越远意味着信噪比降低，比特差错率升高，基站可以提高传输功率或者更换比特率更低的调制方案。

=== R5 信标帧

描述802.11中信标帧的作用。

802.11标准要求每个AP周期性地发送信标帧，每个信标帧包括该AP的SSID和MAC地址。无线主机通过扫描信道和监听信标帧从而发现AP，为后续的关联做准备。

=== R6

是非判断：802.11站在传输一个数据帧前，必须首先发送一个RTS帧并收到一个对应的CTS帧。

错误。RTS/CTS交换仅仅用于为长数据帧预约信道。在实际中，每个无线站点可以设置一个RTS门限值，仅当帧长超过门限值时，才使用RTS/CTS序列。

=== R7 802.11使用了确认

为什么802.11中使用了确认，而有线以太网中却未使用？

因为无线信道具有相对较高的误比特率，如果传输错误被推迟到更高层的协议中处理将会引入更大的时延、消耗更多的资源。

=== R8

是非判断：以太网和802.11使用相同的帧格式。

错误，尽管802.11帧与以太网帧有许多共同特点，但它也包括了许多特定用于无线链路的字段。

=== R9 RTS门限值的工作过程

描述RTS门限值的工作过程。

[.float-group]
--
[.left]
image::fig7-12.png[width=340]

当发送方要发送一个DATA帧时，它能够首先向AP发送一个RTS帧，指示传输DATA帧和确认帧需要的总时间。当AP收到RTS帧后，它广播一个CTS帧作为响应。该CTS帧有两个目的：给发送方明确的发送许可，也指示其他站点在预约期内不要发送。

因此，在图7-12中，在传输DATA帧前，H1首先广播一个RTS帧，该帧能被其范围内包括AP在内的所有站点听到。AP然后用一个CTS帧响应，该帧也被其范围内包括H1和H2在内的所有站点听到。站点H2听到CTS后，在CTS帧中指明的时间内将抑制发送。
--

=== R10

假设IEEE 802.11 RTS和CTS帧与标准的DATA和ACK帧一样长，使用CTS和RTS帧还会有好处吗？为什么？

没有好处。因为碰撞RTS帧的持续时间和碰撞DATA帧一样了。

=== R11 交换机与同一子网BSS间移动

7.3.4节讨论了802.11移动性，其中无线站点从一个BSS到同一子网中的另一个BSS。当AP是通过交换机互连时，为了让交换机能适当地转发帧，一个AP可能需要发送一个带有哄骗的MAC地址的帧，为什么？

[.float-group]
--
[.left]
image::fig7-15.png[width=270]

在移动之前，交换机在其转发表中有一个表项，对应H1的MAC地址与到达H1所通过的出交换机端口。如果H1初始在BSS1中，则发往H1的数据报将经API导向H1。然而，一旦H1与BSS2关联，它的帧应当被导向AP2。一种解决方法是在新的关联形成后，让AP2以H1的源地址向交换机发送一以太网广播帧。当交换机收到该帧后，更新其转发表，使得H1可以通过AP2到达。
--

=== R12

在某蓝牙网络中的一个主设备和在802.11网络中的一个基站之间有什么不同？

[quote]
Any ordinary Bluetooth node can be a master node whereas access points in 802.11 networks are special devices (normal wireless devices like laptops cannot be used as access points).

=== R13

在802.15.4 ZigBee标准中超级帧的含义是什么？

image::fig7-17.png[width=410]

全功能设备使用信标帧以一种时隙方式控制多个简化功能设备。其中ZigBee网络将时间划分为反复出现的超帧，每个超帧以一个信标帧开始。每个信标帧将超帧划分为一个活跃周期和一个非活跃周期。活跃周期由16个时隙组成，其中一些由采用CSMA/CA随机接人方式的设备使用，其中一些由控制器分配给特定的设备，因而为那些设备提供了确保的信道。

=== R14

在3G蜂窝数据体系结构中，“核心网”的作用是什么？

3G核心蜂窝数据网将无线电接人网连接到公共因特网。

=== R15

在3G蜂窝数据体系结构中，RNC的作用是什么？在蜂窝语音网中RNC起什么作用？

无线电网络控制器RNC通常控制几个小区的收发基站。每个小区的无线链路运行在移动节点和收发基站之间，就像在2G网络中那样。RNC既通过MSC与电路交换蜂窝语音网连接，又通过SGSN与分组交换的因特网连接。

=== R16

在4G体系结构中eNodeB、MME、P-GW和S-GW的作用是什么？

见<<4g-let>>。

=== R17

3G和4G蜂窝体系结构之间的3个重要差别是什么？

除了<<comparison-of-234g-cellular-network-architectures>>所讨论的区别，4G网络体系结构清晰地分离了数据平面和控制平面。

=== R18 移动性

如果某节点与因特网具有无线连接，则该节点必定是移动的吗？试解释之。假设一个使用膝上型电脑的用户携带电脑绕着她的住所散步，并且总是通过相同的接人点接人因特网。从网络的角度看，这是移动用户吗？试解释之。

同一个接入网的不同AP，链路层移动；不同接入网，网络层移动；通过使用移动IP，用户移动性对应用层透明。

=== R19

永久地址与转交地址之间的区别是什么？谁指派转交地址？

永久地址是移动节点在归属网络中的IP地址，转交地址是移动节点访问外部网络时获得的IP地址，该地址由外部代理指派。

=== R20

考虑经移动IP的一条TCP连接。是非判断：在通信者和移动主机之间的TCP连接阶段经过该移动用户的归属网络，但数据传输阶段直接通过该通信者和移动主机，绕开了归属网络。

错误。由通信者发往移动主机的数据报需要通过归属网络经隧道转发，而由移动主机发往通信者的数据报可以绕开归属网络直接发送。

=== R21

在GSM网络中，HLR和VLR的目的是什么？移动IP的什么要素类似于HLR和VLR？

归属网络维护一个称作归属位置注册器（Home Location Register，HLR）的数据库，其中包括它每个用户的永久蜂窝电话号码以及用户个人概要信息。重要的是，HLR也包括这些用户当前的位置信息。

被访网络维护一个称作访问者位置注册（Visitor Location Register，VLR）的数据库。VLR为每一个当前在其服务网络中的移动用户包含一个表项，VLR表项因此随着移动用户进人和离开网络而出现或消失。

移动IP中归属网络的边缘路由器类似于GSM中的HLR，外部网络的边缘路由器类似于GSM中的VLR。

=== R22

在GSM网络中，锚MSC的作用是什么？

锚MSC是呼叫首次开始时移动用户所访问的MSC，当移动用户从一个MSC覆盖区到达另一个MSC覆盖区后，正在进行的呼叫被重路由选择，从锚MSC到包含新基站的新被访问MSC。

=== R23

为了避免单一无线链路降低一条端到端运输层TCP连接的性能，能够采取的三种方法是什么？

. 本地恢复，在比特差错出现的当时和当地将其恢复。
. TCP发送方知晓无线链路，从而将在有线网络中发生的拥塞性丢包和在无线网络中发生的差错/丢包区分开，并且仅对有线网络中的拥塞性丢包采用拥塞控制。
. 分离连接方法，经有线段的运输层是标准的TCP协议，经无线段的运输层是一个特别定制运行在UDP上的差错恢复协议。
