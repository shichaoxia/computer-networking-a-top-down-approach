= 计算网络: 自顶向下方法: 笔记与题解
:imagesdir: ./img
:toc: left
:toclevels: 3
:stem: latexmath
:sectlinks:

link:legacy.html[1~5章]

== 链路层和局域网

=== 笔记

==== 多路访问链路和协议

[plantuml, target=ch6-3a, format=svg]
....
@startmindmap
* 多路访问链路和协议

** 网络链路
*** 点对点链路
**** 点对点协议PPP
**** 高级数据链路控制HDLC
*** 广播链路

** 多路访问协议
*** 信道划分协议
**** 时分多路复用TDM
**** 频分多路复用FDM
**** 码分多址CDMA
*** 随机接入协议
**** 时隙ALOHA
**** 纯ALOHA
**** 具有碰撞检测的载波侦听多路访问CSMA/CD
*** 轮流协议
**** 轮询协议
**** 令牌传递协议
@endmindmap
....

.信道划分协议的比较
[cols="4*^.^"]
|===
| |TDM |FDM |CDMA

|信道划分
|时间
|频率
|编码

|优点
3+|消除碰撞且公平

.2+|缺点
3+|节点被限制于R/Nbps平均速率

|节点必须总是等待它在传输序列中的轮次
|
|
|===

.随机接入协议的比较
|===
||时隙ALOHA |纯ALOHA| CSMA/CD

.3+.^|特点

3+^|唯一活跃节点以全速R连续传输

|时隙等于传输一帧的时间
|非时隙（碰撞重传阶段也有了时隙的概念）
|非时隙

|分散，每个节点检测碰撞并独立决定什么时候重传
|分散
|载波侦听和碰撞检测

.^|传输过程
a|. 新帧到达须等到下一个时隙开始并在该时隙传输整个帧
. 如果有碰撞，该节点在时隙结束之前检测到这次碰撞
. 以概率p在后续每个时隙中重传
a|. 当一帧首次到达立即完整传输进广播信道
. 在完全传输完碰撞帧后
. 节点立即以概率p重传，否则等待一个帧传输时间
a|. 获得数据报先放入缓存，侦听到信道空闲开始传送
. 传送过程中给侦听到碰撞停止传输
. 等待一个随机时间(由指数后退算法确定)，继续侦听信道准备传送

|效率
|最大约0.37
|时隙ALOHA的一半
|接近1
|===

.从适配器角度总结CSMA/CD的运行
[plantuml, target=ch6-3b, format=svg]
....
@startuml
hide empty description
[*] --> Ready
Ready --> Listening : 获得一条数据报\n----\n准备链路层帧\n放入帧适配器缓存
Listening --> Sending : 信道空闲\n----\n传输帧
Listening --> Listening : 信道忙
Sending --> Ready : 未碰撞
Sending --> Backoff : 碰撞
Backoff --> Listening : 等待时间结束
@enduml
....

.轮流协议的比较
|===
||轮询协议|令牌传递协议

|优点
2+^|消除了随机协议的碰撞和空时隙

|过程
|主节点以循环的方式轮询每个节点
|一个称为令牌的小的特殊帧在节点之间以某种固定的次序进行交换

|缺点
a|. 一个活跃节点将以小于Rbps的速率传输
. 主节点有故障导致整个信道不可用
|一个节点的故障会导致整个信道崩溃
|===

.多路访问协议的比较
|===
||信道划分协议|随机接入协议|轮流协议

|当仅有一个节点发送数据时该节点的吞吐量
|R/N
|R
a|* 轮询协议<R
* 令牌传递协议为R

|当有M个节点发送数据时每个节点的吞吐量
|R/N
a|* 时隙ALOHA为0.37R/M
* 纯ALOHA是时隙ALOHA的一半
* CSMA/CD为R/M
a|* 轮询协议<R/M
* 令牌传递协议为R/M

|是否分散
|是
|是
|否
|===

image::fig6-12.png[width=560]
image::fig6-15.png[width=500]
image::fig6-17.png[width=360]
image::fig6-19.png[width=560]
image::fig6-24.png[width=430]
image::fig6-30.png[width=390]

=== 复习题

==== R1

考虑在6.1节（p.286）中的运输类比。如果一个乘客类比为一个数据报，什么类比于链路层帧？

乘客和乘客乘乘坐的交通工具（轿车、飞机、火车）一起构成一个链路层帧。

==== R2 链路层的可靠交付服务与TCP可靠传输服务

如果在因特网中的所有链路都提供可靠的交付服务，TCP可靠传输服务将是多余的吗？为什么？

TCP可靠传输服务确保传输数据比特不会收到损坏或丢失，且按序交付。而链路层提供的可靠交付服务是面向链路层帧的，这就不能保证数据按序交付。此外，由于路由环路或设备故障，IP可能会丢失数据包。所以TCP可靠传输服务不是多余的。

==== R3 链路层提供的服务与IP、TCP

链路层协议能够向网络层提供哪些可能的服务？在这些链路层服务中，哪些在IP中有对应的服务？哪些在TCP中有对应的服务？

链路层协议向网络层提供的服务：

. 成帧。TCP同样将应用层报文分段，将其封装成运输层报文段。IP将运输层报文段（分片并）用网络层数据报封装起来。
. 链路接入。
. 可靠交付。TCP提供更宏观的可靠运输服务。
. 差错检测和纠正。IP和TCP提供有限的差错检测，即因特网检验和。

==== R4

假设两个节点同时经一个速率为R的广播信道开始传输一个长度为L的分组。用d~prop~表示这两个节点之间的传播时延。如果d~prop~<L/R，会出现碰撞吗？为什么？

image:ch6-r4.png[]

假设节点在t~0~开始传输分组，在t~2~传输完成。由于d~prop~<L/R，节点会在t~1~收到其他节点发送的分组，因此会发生碰撞。

==== R5

在6.3节中，我们列出了广播信道的4种希望的特性。这些特性中的哪些是时隙ALOHA所具有的？令牌传递具有这些特性中的哪些？

[cols="1h,2*"]
|===
||时隙ALOHA |令牌传递

|1）单节点传输时，该节点具有Rbps吞吐量
|✓
|✓

|2）M个节点传输时，每节点具有R/Mbps吞吐量
|✗ 大概0.37R/M
|✓

|3）分散的
|✗ 不完全分散，节点之间需要同步时隙
|✓

|4）简单的
|✓
|✓
|===

==== R6 二进制指数后退算法的计算

在CSMA/CD中，在第5次碰撞后，节点选择K=4的概率有多大？结果K=4在10Mbps以太网上对应于多少秒的时延？

在经历n次碰撞后的K待选集合是stem:[\{0, 1, 2, \dotsc, 2^n-1\}]。当n=5时，这是集合是stem:[\{0, 1, \dotsc, 31\}]，因此选择K=4的概率是1/32。

10Mbps以太网上T~512b~=512b÷10Mbps=51.2ms，因此时延是K×T~512b~=4×5.12ms=204.8ms。

==== R7

使用人类在鸡尾酒会交互的类比来描述轮询和令牌传递协议。

在轮询中，一个主持人每次只允许一个参与者说话，每个参与者都有机会以轮流的方式说话。对于令牌传递，没有主持人，但有酒杯，参与者轮流拿着。只有当参与者拿着酒杯的时候，才允许他说话。

==== R8

如果局域网有很大的周长时，为什么令牌环协议将是低效的？

当一个节点发送一个帧时，该节点必须等待该帧在整个环上传播，然后该节点才能释放令牌。因此，如果L/R与t~prop~相比很小，那么该协议将是低效的。
